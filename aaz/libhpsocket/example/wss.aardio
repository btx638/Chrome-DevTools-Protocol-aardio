import win.ui;
/*DSG{{*/
var winform = win.form(text="aardio form";right=751;bottom=431)
winform.add(
btnConnect={cls="button";text="连接";left=216;top=8;right=296;bottom=40;z=8};
btnSend={cls="button";text="发送";left=248;top=80;right=331;bottom=119;z=1};
edOrigin={cls="edit";text="https://www.piesocket.com";left=472;top=8;right=705;bottom=40;edge=1;multiline=1;z=5};
edUrl={cls="edit";text="wss://demo.piesocket.com/v3/channel_1?api_key=oCdCMcMPQpbvNjUIzqtvF1d2X2okWpDQj4AwARJuAgtjhzKxVEjQU6IdCjwm&notify_self";left=40;top=8;right=208;bottom=40;edge=1;multiline=1;z=4};
edit={cls="edit";text="Edit";left=8;top=80;right=241;bottom=119;edge=1;multiline=1;z=2};
richedit={cls="richedit";left=8;top=128;right=744;bottom=416;edge=1;multiline=1;z=3};
static={cls="static";text="origin";left=424;top=16;right=464;bottom=40;transparent=1;z=6};
static2={cls="static";text="url";left=8;top=16;right=40;bottom=40;transparent=1;z=7}
)
/*}}*/

io.open()

import aaz.libhpsocket.app.simpleWebsocketClient.wss;

var ws = aaz.libhpsocket.app.simpleWebsocketClient.wss();

ws.on("open", function(){
	winform.btnSend.disabled = false;	
	winform.richedit.print("已连接")
})

ws.on("close", function(){
	winform.richedit.print("关闭")
})

ws.on("message", function(msg){
	winform.richedit.print("接收：", msg)
})


winform.btnSend.disabled = true;
winform.btnSend.oncommand = function(id,event){
	var ok = ws.send(winform.edit.text);
	winform.richedit.print( "发送", ok?"成功":"失败"  );
}

winform.btnConnect.oncommand = function(id,event){
	winform.btnConnect.disabled = true;
	
	ws.origin = winform.edOrigin.text;
	ws.connect(winform.edUrl.text);	
}

winform.show();
win.loopMessage();